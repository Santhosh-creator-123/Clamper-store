<%- include('../partials/header') %>
<section class="checkout">
  <h2>Checkout</h2>

  <div class="checkout-container">
    <form id="checkoutForm" class="checkout-form">
      <h3>Billing Details</h3>

      <label for="name">Full name</label>
      <input type="text" id="name" name="name" required />

      <label for="email">Email Address</label>
      <input type="email" id="email" name="email" required />

      <label for="phone">Phone Number</label>
      <input type="tel" id="phone" name="phone" required />

      <label for="address">Address</label>
      <textarea id="address" name="address" required></textarea>

      <h3>Payment Method</h3>
      <label><input type="radio" name="payment" value="cod" checked> Cash on Delivery</label><br>
      <label><input type="radio" name="payment" value="card"> Credit / Debit Card</label><br>
      <label><input type="radio" name="payment" value="upi"> UPI</label><br>

      <input type="hidden" id="amount" value="500" /> <!-- â‚¹500 -->

      <button type="submit">Place Order</button>
    </form>

    <!-- Order Summary -->
    <div class="order-summary">
      <h3>Your Order</h3>
      <ul>
        <li>Product 1 <span>$29.99</span></li>
        <li>Product 2 <span>$39.99</span></li>
      </ul>
      <p>Subtotal: <span>$69.98</span></p>
      <p>Shipping: <span>$5.00</span></p>
      <h4>Total: <span>$74.98</span></h4>
    </div>
  </div>
</section>

<script>
document.getElementById("checkoutForm").onsubmit = async function (e) {
  e.preventDefault();
  const orderId = "order_" + Date.now();

  const response = await fetch("/phonepe-create-order", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      amount: parseInt(document.getElementById("amount").value),
      orderId: orderId,
      customerMobile: document.getElementById("phone").value,
      customerEmail: document.getElementById("email").value,
      customerName: document.getElementById("name").value,
      customerAddress: document.getElementById("address").value
    }),
  });

  const data = await response.json();
  if (data && data.payload) {
    window.location.href = data.payload.merchantPgRedirectUrl;
  } else {
    alert("Failed to initiate payment");
  }
};
</script>

<%- include('../partials/footer') %>
